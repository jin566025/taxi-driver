function getCodeReturn(){$.ajax({type:"post",url:url_path+"/wx/queryAppId.json",dataType:"json",success:function(e){if("成功"==e.msg){var t=e.appId,s=(e.appSecret,sessionStorage.getItem("code"));console.log(s),s||(window.location.href="http://taxicustomer.nbzhidun.com/get-weixin-code.html?appid="+t+"&scope=snsapi_base&state=hello-world&redirect_uri=http%3a%2f%2ftaxidriver.nbzhidun.com%2findex.html")}},error:function(){}})}function getCode(){var e=window.location.href.split("=")[1];if(e){var t=e.split("&")[0];sessionStorage.setItem("code",t),t&&$.ajax({type:"post",url:url_path+"/getAccessToken.json",data:{code:t},dataType:"json",async:!1,success:function(e){var t=e.openid;sessionStorage.setItem("openid",t),localStorage.setItem("openid",t)}})}}var driverId=localStorage.getItem("driverId");driverId||(getCodeReturn(),getCode());var driverHasLogin=localStorage.getItem("driverHasLogin"),openid=localStorage.getItem("openid");function login(e){var a=$("#username").val(),t=$("#ymz").val();console.log(isPhoneNo(a)),isPhoneNo(a)?""==t?$("#tips2").css("visibility","visible").html("请输入验证码"):$.ajax({type:"post",url:e+"/driver/login.json",data:{username:a,validateCode:t},dataType:"json",success:function(e){if("用户不存在"==e.msg)$("#tips1").css("visibility","visible").html(e.msg),$("#tips2").css("visibility","hidden").html("");else if("成功"==e.msg){var t=e.nickname,s=e.score,i=e.userId,o=e.userImg;localStorage.setItem("drivernickname",t),localStorage.setItem("driverscore",s),localStorage.setItem("driverId",i),localStorage.setItem("driverImg",o),localStorage.setItem("driverHasLogin",!0);var n=localStorage.getItem("openid");$.ajax({type:"post",url:url_path+"/driver/loginOauth.json",async:!1,data:{userOpenid:n,username:a},dataType:"json",success:function(e){if(console.log(e),"成功"==e.msg){var t=e.nickname,s=e.score,i=e.userId,o=e.userImg;localStorage.setItem("usernickname",t),localStorage.setItem("userscore",s),localStorage.setItem("userId",i),localStorage.setItem("userImg",o),window.location.href="index2.html"}}})}else $("#tips1").css("visibility","visible").html(e.msg),$("#tips2").css("visibility","hidden").html("")}}):$("#tips1").css("visibility","visible").html("请输入正确的手机号码")}function getLoginSMS(e){var t=$("#username").val();if(console.log(t),isPhoneNo(t)){$("#tips1").css("visibility","hidden");var s=60;$("#send-yzm").addClass("disabled");var i=setInterval(function(){s-=1,$("#send-yzm").html(s)},1e3);setTimeout(function(){$("#send-yzm").html("点击发送验证码").removeClass("disabled"),window.clearInterval(i)},6e4),$.ajax({type:"get",url:e+"/driver/getLoginSMS.json",dataType:"json",data:{username:t},success:function(e){console.log(e),e.msg},error:function(){}})}else $("#tips1").css("visibility","visible").html("请输入正确的手机号码")}function isPhoneNo(e){return/^1[34578]\d{9}$/.test(e)}driverHasLogin&&openid&&(window.location.href="index2.html"),$("#send-yzm").click(function(){getLoginSMS(url_path)}),$(".login-btn").click(function(){login(url_path)});