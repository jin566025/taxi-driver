$(function(){function L(t){var s=new Date(parseInt(t)),e=s.getMonth()+1;e<10&&(e="0"+e);var a=s.getDate();a<10&&(a="0"+a);var i=s.getHours();i<10&&(i="0"+i);var d=s.getMinutes();d<10&&(d="0"+d);var r=s.getSeconds();return r<10&&(r="0"+r),s.getFullYear()+"-"+e+"-"+a+" "+i+":"+d+":"+r}$(".list").on("click",".list-main",function(){var t=$(this).data("taskid"),s=$(this).data("typeid");4==s?window.location.href="pages/order-list/order-detail4.html?taskId="+t:1==s?window.location.href="pages/order-list/order-detail1.html?taskId="+t:2==s?window.location.href="pages/order-list/order-detail2.html?taskId="+t:3==s?window.location.href="pages/order-list/order-detail3.html?taskId="+t:5==s&&(window.location.href="pages/order-list/order-detail5.html?taskId="+t)});var t=1,s=sessionStorage.getItem("driverLat"),e=sessionStorage.getItem("driverLng");function M(t,s,e,a){var i=t*Math.PI/180,d=e*Math.PI/180,r=i-d,l=s*Math.PI/180-a*Math.PI/180,o=2*Math.asin(Math.sqrt(Math.pow(Math.sin(r/2),2)+Math.cos(i)*Math.cos(d)*Math.pow(Math.sin(l/2),2)));return o*=6378.137,o=Math.round(1e4*o)/1e4}function a(t,s,e){$.ajax({type:"post",url:e+"/mission/missionList.json",async:!1,data:{pageNo:t,pageSize:s},dataType:"json",success:function(t){if(console.log(t),"成功"==t.msg){$("#shadow").fadeOut(500),$("#getAddress").fadeOut(500);var s=t.listDTO;30!==s.length&&$(".nomore").html("---加载完毕---").removeClass("hasmore");for(var e,a,i=sessionStorage.getItem("driverLng"),d=sessionStorage.getItem("driverLat"),r=0;r<s.length;r++){var l=M(d,i,e=s[r].deliveryAddressLatitude,a=s[r].deliveryAddressLongitude)+1;l=l.toFixed(2);var o,n,c,v,h,g,p,f,u=s[r].typeId,m="";f=s[r].finish;var w=s[r].taskAddress,y=s[r].distance;y?y=s[r].distance+"公里":(targetLat2=s[r].taskAddressLatitude,targetLng2=s[r].taskAddressLongitude,y=(y=M(targetLat2,targetLng2,e,a)+1).toFixed(2)+"公里");var I=s[r].deliveryAddress;I?I=s[r].deliveryAddress:(I="如不填写，由司机决定",l="自定义",y="自定义公里"),1==u?(n="送取件",o="lists-right3",c="红包",v="type1",h="",p=s[r].goodsType,g=s[r].award):2==u?(n="代购",o="lists-right2",c="垫资资金",v="type2",h="",p=s[r].message,g=s[r].matmoney):3==u?(n="打车",o="lists-right4",c="",v="type3",h="hide_cls",g=p=" ",f="打表",m="font2"):4==u?(n="日常代驾",o="lists-right3",c="红包",v="type4",h="hide_cls",p=" ",g=s[r].award):5==u&&(n="包时代驾",o="lists-right4",c="",v="type4",h="hide_cls",p=" ",g=s[r].money,f=s[r].money,I=w,l=(l=M(d,i,targetLat2,targetLng2)+1).toFixed(2),w=L(s[r].startTime),y="当前位置："+s[r].deliveryAddress);var x='<div class="list-main" data-typeId='+s[r].typeId+" data-taskId="+s[r].id+'><div class="lists-content flex-box"><div class="lists-left flex-box"><div class="lists-left-price"><a class="fuhao">￥</a><a class="price '+m+'" >'+f+'</a></div><div class="lists-left-detail"><div class="lists-left-detail-top '+h+'">'+p+'</div><br class="'+h+'" /><div class="type '+v+'">'+n+'</div></div></div><div class="lists-right '+o+'"><p><a>￥</a><a class="lists-right2-price" >'+g+"</a></p><p>"+c+'</p></div></div><div class="start-end flex-box"><div class="start-end-left flex-box"><a class="circles strat-circle"></a><div class="start-end-detail">'+I+'</div></div><div class="start-end-right">'+l+'公里</div></div><div class="start-end flex-box"><div class="start-end-left flex-box"><a class="circles end-circle"></a><div class="start-end-detail">'+w+'</div></div><div class="start-end-right" >'+y+"</div></div></div>";$(".list").append(x)}}},error:function(){}})}s&&e&&($("#shadow").fadeOut(500),$("#getAddress").fadeOut(500)),a(t,30,url_path),$(window).scroll(function(){$(window).scrollTop()+$(window).height()>=$(document).height()&&$(".nomore").hasClass("hasmore")&&a(t+=1,30,url_path)})});