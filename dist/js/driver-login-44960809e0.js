function getCodeReturn(){$.ajax({type:"post",url:url_path+"/wx/queryAppId.json",dataType:"json",success:function(e){if("成功"==e.msg){var i=e.appId,t=e.appSecret;sessionStorage.setItem("appSecret",t),localStorage.setItem("appId",i);var s=sessionStorage.getItem("code"),o=window.location.href.split("userOpenid=")[1];if(o){var n=o.split("?type=")[0],r=o.split("?type=")[1];sessionStorage.setItem("userOpneid",n),sessionStorage.setItem("userType",r)}s||(window.location.href="http://taxicustomer.nbzhidun.com/get-weixin-code.html?appid="+i+"&scope=snsapi_base&state=hello-world&redirect_uri=http%3a%2f%2ftaxidriver.nbzhidun.com%2findex.html")}},error:function(){}})}function getCode(){var e=window.location.href.split("code=")[1];if(e){var i=e.split("&")[0];sessionStorage.setItem("code",i)}}var driverId=localStorage.getItem("driverId");driverId||(getCodeReturn(),getCode());var driverHasLogin=localStorage.getItem("driverHasLogin"),openid=localStorage.getItem("openid");function login(e){var i=$("#username").val(),t=$("#ymz").val(),s=sessionStorage.getItem("code");isPhoneNo(i)?""==t?$("#tips2").css("visibility","visible").html("请输入验证码"):$.ajax({type:"post",url:e+"/driver/login.json",data:{username:i,validateCode:t,code:s},dataType:"json",success:function(e){if(console.log(e),"用户不存在"==e.msg)$("#tips1").css("visibility","visible").html(e.msg),$("#tips2").css("visibility","hidden").html("");else if("成功"==e.msg){e.nickname,e.score,e.userId,e.userImg;localStorage.setItem("drivernickname",e.nickname),localStorage.setItem("driverscore",e.score),localStorage.setItem("driverId",e.userId),localStorage.setItem("driverImg",e.userImg),localStorage.setItem("driverHasLogin",!0),localStorage.setItem("openid",e.userOpenid),localStorage.setItem("token",e.token),window.location.href="index2.html"}else $("#tips1").css("visibility","visible").html(e.msg),$("#tips2").css("visibility","hidden").html("")}}):$("#tips1").css("visibility","visible").html("请输入正确的手机号码")}function getLoginSMS(e){var i=$("#username").val();if(console.log(i),isPhoneNo(i)){$("#tips1").css("visibility","hidden");var t=60;$("#send-yzm").addClass("disabled");var s=setInterval(function(){t-=1,$("#send-yzm").html(t)},1e3);setTimeout(function(){$("#send-yzm").html("点击发送验证码").removeClass("disabled"),window.clearInterval(s)},6e4),$.ajax({type:"get",url:e+"/driver/getLoginSMS.json",dataType:"json",data:{username:i},success:function(e){console.log(e),"成功"==e.msg||$("#tips1").css("visibility","visible").html(e.msg)},error:function(){}})}else $("#tips1").css("visibility","visible").html("请输入正确的手机号码")}function isPhoneNo(e){return/^1[34578]\d{9}$/.test(e)}driverHasLogin&&openid&&driverId&&(window.location.href="index2.html"),$("#send-yzm").click(function(){getLoginSMS(url_path)}),$(".login-btn").click(function(){login(url_path)});